# 課題 #002：取引先のポテンシャル可視化（親レコード更新）

## 1. 課題の背景と要件
- **背景**: 取引先画面で、関連する「進行中の商談」の合計金額をひと目で把握できるようにしたい。
- **要件**:
    - 商談の作成・更新・削除・復元時に動作すること。
    - フェーズが `Closed Won` / `Closed Lost` 以外の商談の `Amount` を合計する。
    - 親取引先の `Description` 欄に「現在の進行中商談の合計額は ¥[金額] です」と書き込む。
    - **実務視点**: 取引先が付け替えられた場合、新旧両方の取引先を再計算すること。

## 2. Git 運用
- **ブランチ名**: `feature/002-account-summary-update`
- **コミット名**: `[#002] feat: 進行中商談の合計金額を親取引先の説明欄に集計するロジックの実装`

## 3. 設計メモ
- **ID収集**: `Trigger.new` と `Trigger.oldMap` を比較し、`AccountId` が変わった場合は両方のIDを `Set<Id>` に集める。
- **集計**: `AggregateResult` を用いた `GROUP BY AccountId` クエリで効率的に合計額を取得する。
- **バルク化**: 収集したIDをもとに一括でクエリ・更新を行い、ガバナ制限を回避する。

## 4. 躓いた点・エラーの記録
- （実装中に発生したエラーや、解決に時間がかかったロジックをここに追記してください）

## 5. 学び・成長点
- （AggregateResultの使い方や、リぺアレンティング（親の付け替え）対応で学んだことを追記してください）